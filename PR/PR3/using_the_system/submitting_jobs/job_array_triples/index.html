<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Job Arrays with LLsub Triples in 3 Steps &mdash; MIT SuperCloud Documentation  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="canonical" href="https://supercloud.mit.edu/using_the_system/submitting_jobs/job_array_triples/index.html"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/js/custom.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Best Practices" href="../../best_practices/index.html" />
    <link rel="prev" title="Submitting Jobs" href="../submitting_jobs/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            MIT SuperCloud Documentation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../requesting_account/index.html">Requesting an Account</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../requesting_account/index.html#account-request-process">Account Request Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../requesting_account/index.html#why-do-we-ask-if-you-are-using-data-that-is-not-publicly-available">Why do we ask if you are using data that is not publicly available?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../requesting_account/index.html#generating-ssh-keys-for-supercloud-authentication">Generating ssh Keys for Supercloud Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../requesting_account/index.html#adding-your-ssh-keys-to-your-account">Adding your SSH Keys to your Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../requesting_account/index.html#current-approver-list">Current Approver List</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started/index.html">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html#logging-in-via-ssh">Logging in Via ssh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html#shared-hpc-clusters">Shared HPC Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html#software-and-packages">Software and Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html#linux-command-line">Linux Command Line</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html#transferring-files-to-mit-supercloud">Transferring Files to MIT SuperCloud</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html#testing-your-code">Testing your Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_started/index.html#supercloud-downtimes">SuperCloud Downtimes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../systems_and_software/index.html">Systems and Software</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../systems_and_software/index.html#mghpcc-tx-e1-specifications">MGHPCC TX-E1 Specifications</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../systems_and_software/index.html#available-languages">Available Languages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../systems_and_software/index.html#modules">Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../systems_and_software/index.html#software">Software</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../systems_and_software/index.html#machine-learning-tools">Machine Learning Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../systems_and_software/index.html#big-data-software-stack">Big Data Software Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../systems_and_software/index.html#middleware-software-stack">Middleware Software Stack</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../systems_and_software/index.html#lincoln-laboratory-developed-software">Lincoln Laboratory Developed Software</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../systems_and_software/index.html#compilers">Compilers</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Using the Systetm</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../files_and_data/index.html">Files and Data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../files_and_data/transferring_files/index.html">Transferring Files</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../files_and_data/transferring_files/index.html#mac-linux-and-most-windows">Mac/Linux and Most Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../files_and_data/transferring_files/index.html#windows">Windows</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../files_and_data/transferring_files/index.html#downloading-files-through-the-web-portal">Downloading Files through the Web Portal</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../files_and_data/transferring_files/index.html#uploading-and-downloading-files-using-jupyter">Uploading and Downloading Files Using Jupyter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../files_and_data/shared_groups/index.html">Shared Groups</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../files_and_data/shared_groups/index.html#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../files_and_data/shared_groups/index.html#joining-or-creating-a-group">Joining or Creating a Group</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../files_and_data/shared_groups/index.html#using-shared-groups-effectively">Using Shared Groups Effectively</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../software_packages/index.html">Software and Package Management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../software_packages/index.html#modules">Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../software_packages/index.html#installing-software-or-packages-in-your-home-directory">Installing Software or Packages in your Home Directory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../software_packages/index.html#julia-packages">Julia Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../software_packages/index.html#python-packages">Python Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../software_packages/index.html#r-libraries">R Libraries</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../monitoring_system_and_jobs/index.html">Monitoring System and Job Status</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../monitoring_system_and_jobs/index.html#checking-system-status">Checking System Status</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../monitoring_system_and_jobs/index.html#monitoring-jobs">Monitoring Jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../monitoring_system_and_jobs/index.html#stopping-jobs">Stopping Jobs</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">Submitting Jobs</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../submitting_jobs/index.html">Submitting Jobs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../submitting_jobs/index.html#how-to-start-an-interactive-job-with-llsub">How to start an Interactive Job with LLsub</a></li>
<li class="toctree-l4"><a class="reference internal" href="../submitting_jobs/index.html#submitting-a-simple-serial-batch-job">Submitting a Simple Serial Batch Job</a></li>
<li class="toctree-l4"><a class="reference internal" href="../submitting_jobs/index.html#requesting-additional-resources-with-sbatch">Requesting Additional Resources with sbatch</a></li>
<li class="toctree-l4"><a class="reference internal" href="../submitting_jobs/index.html#requesting-additional-resources-with-llsub">Requesting Additional Resources with LLsub</a></li>
<li class="toctree-l4"><a class="reference internal" href="../submitting_jobs/index.html#llmapreduce">LLMapReduce</a></li>
<li class="toctree-l4"><a class="reference internal" href="../submitting_jobs/index.html#matlab-octave-tools">Matlab/Octave Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="../submitting_jobs/index.html#triples-mode">Triples Mode</a></li>
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Job Arrays with LLsub Triples in 3 Steps</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-1-batch-up-your-array">Step 1: Batch Up your Array</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-changing-your-submission-script">Step 2: Changing Your Submission Script</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-submit-your-job-with-llsub-triples">Step 3: Submit your Job with LLsub Triples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../best_practices/index.html">Best Practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../best_practices/filesystem/index.html">Best Practices for Using the Filesystem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../best_practices/filesystem/index.html#installing-python-packages">Installing Python Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../best_practices/filesystem/index.html#submitting-jobs">Submitting Jobs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../best_practices/filesystem/index.html#file-organization">File Organization</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../best_practices/gpu_jobs/index.html">Optimizing your GPU Jobs</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../best_practices/gpu_jobs/index.html#getting-more-out-of-the-gpus">Getting More out of the GPUs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../best_practices/gpu_jobs/index.html#requesting-more-gpus">Requesting More GPUs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../web_portal/index.html">Web Portal</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../web_portal/index.html#portal-authentication">Portal Authentication</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../web_portal/index.html#mit-touchstone-incommon-federation">MIT Touchstone/InCommon Federation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web_portal/index.html#username-and-password">Username and Password</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../web_portal/index.html#pki-certificate-smart-card">PKI Certificate/Smart Card</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../web_portal/index.html#adding-removing-ssh-keys">Adding/Removing SSH Keys</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../web_portal/index.html#browsing-your-home-directory">Browsing your Home Directory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../databases/index.html">Databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../jupyter_notebooks/index.html">Jupyter Notebooks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../jupyter_notebooks/index.html#starting-up-jupyter">Starting Up Jupyter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../jupyter_notebooks/index.html#the-jupyter-environment">The Jupyter Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../jupyter_notebooks/index.html#a-note-on-environment-variables-and-modules">A Note on Environment Variables and Modules</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../faqs/index.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#how-do-i-get-an-account">How do I get an account?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#i-would-like-to-log-in-from-a-new-computer-can-i-add-a-new-ssh-key">I would like to log in from a new computer. Can I add a new ssh key?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#how-much-storage-do-i-have-for-my-account">How much storage do I have for my account?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#how-can-i-share-files-code-data-with-my-colleagues">How can I share files/code/data with my colleagues?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#how-do-i-set-change-my-password">How do I set/change my password?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#are-there-any-resource-limits">Are there any resource limits?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#what-do-i-do-if-my-job-won-t-be-deleted">What do I do if my job won’t be deleted?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#why-do-i-get-an-error-when-i-try-to-install-a-package">Why do I get an error when I try to install a package?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#how-can-i-set-up-vscode-to-edit-files-remotely-on-supercloud">How can I set up VSCode to edit files remotely on Supercloud?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#how-can-i-use-tensorboard-on-supercloud">How can I use Tensorboard on Supercloud?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#i-got-an-out-of-memory-error-how-can-i-figure-out-how-much-memory-my-job-needs-and-request-more">I got an Out of Memory error. How can I figure out how much memory my job needs and request more?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#my-python-julia-job-is-running-but-i-don-t-see-any-output-in-the-log-files-what-is-going-on">My Python/Julia job is running, but I don’t see any output in the log files. What is going on?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#what-does-the-underutilizing-oversubscribing-the-node-warning-message-mean">What does the Underutilizing/Oversubscribing the node warning message mean?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../faqs/index.html#how-can-i-get-more-help">How can I get more help?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_help/index.html">Getting Help</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_help/index.html#additional-documentation">Additional Documentation:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_help/index.html#email">Email:</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../getting_help/index.html#office-hours">Office Hours:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../online_courses/index.html">Online Courses</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../online_courses/index.html#some-available-online-courses">Some Available Online Courses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../online_courses/index.html#accessing-the-llx-online-course-site">Accessing the LLx Online Course Site</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../online_courses/index.html#creating-an-online-course-account">Creating an Online Course Account</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../online_courses/index.html#questions">Questions?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/index.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../acknowledging_us/index.html">Acknowledging Us</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">MIT SuperCloud Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Using the Systetm</a></li>
          <li class="breadcrumb-item"><a href="../index.html">Submitting Jobs</a></li>
      <li class="breadcrumb-item active">Job Arrays with LLsub Triples in 3 Steps</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/llsc-supercloud/supercloud-docs-edit/blob/main/using_the_system/submitting_jobs/job_array_triples/index.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="job-arrays-with-llsub-triples-in-3-steps">
<span id="job-array-triples"></span><h1>Job Arrays with LLsub Triples in 3 Steps<a class="headerlink" href="#job-arrays-with-llsub-triples-in-3-steps" title="Permalink to this heading"></a></h1>
<p>If you are currently running a Job Array, you can take advantage of
SuperCloud’s triples mode submission by submitting your job array with
LLsub. In most cases, this can be done in a few easy steps.</p>
<p>What is triples mode? It’s a different way to submit your job by
specifying three numbers:</p>
<ul class="simple">
<li>Nodes: The number of nodes you want to use up</li>
<li>NPPN: The number of processes that should run per node</li>
<li>NT: The number of threads per process</li>
</ul>
<p>Why would you want to use triples mode to submit your job? Triples mode
provides a few advantages. Since it does whole-node scheduling you don’t
have to worry about other jobs impacting yours (or your job impacting
someone else’s). We also do task-pinning when you request resources with
a triple, so your processes are arranged in the best way possible for
the layout of the hardware architecture. Finally, submitting a Job Array
with LLsub triples mode the way we describe here will greatly reduce the
startup time for your jobs, over a job array with many pending tasks.</p>
<div class="section" id="step-1-batch-up-your-array">
<h2>Step 1: Batch Up your Array<a class="headerlink" href="#step-1-batch-up-your-array" title="Permalink to this heading"></a></h2>
<p>The first thing you want to do is set up your job so that your script
splits up your inputs among each process/task and each process/task
iterates a subset of your inputs. This way you can change your input set
without changing the number of tasks or processes that you schedule.
This step alone will save you on startup time. Anytime you submit more
jobs than your allocation allows, those additional jobs will remaining
pending until some of your first running jobs complete. Then, when one
of your first jobs complete, the scheduler now has to find the pending
job some resources and start it running. If you batch up your job array,
you only have to go through the scheduling process once. If you’ve set
up a job array following our instructions in the past you may already be
doing this, and you can skip to the next section.</p>
<p>First you want to take a look at your code. Code that can be submitted
as a Job Array usually has one big for loop. If you are iterating over
multiple parameters or files, and have nested for loops, you’ll first
want to enumerate all the combinations of what you are iterating over so
you have one big loop.</p>
<p>If your code is written so it uses the <code class="docutils literal notranslate"><span class="pre">$SLURM_ARRAY_TASK_ID</span></code> and uses
that to run a single thing, first add a for loop that iterates over the
full set of things you want to run your code on. If you can’t rewrite
your code in such a way that it iterates over multiple inputs, you can
use LLMapReduce to submit your job with triples mode, see <a class="reference external" href="https://github.com/llsc-supercloud/teaching-examples/tree/master/C-Cpp/Fibonacci/LLMapReduce" target="_blank">this
example</a>.</p>
<p>Then you add a few lines to your code to take in two arguments, a
process/task ID and the number of processes/tasks, and use those numbers
to split up the thing you are iterating over. For example, I might have
a list of filenames, <code class="docutils literal notranslate"><span class="pre">fnames</span></code>. In python I would add:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Grab</span> <span class="pre">the</span> <span class="pre">arguments</span> <span class="pre">that</span> <span class="pre">are</span> <span class="pre">passed</span> <span class="pre">in</span> <span class="pre">my_task_id</span> <span class="pre">=</span> <span class="pre">int(sys.argv[1])</span> <span class="pre">num_tasks</span> <span class="pre">=</span> <span class="pre">int(sys.argv[2])</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Assign</span> <span class="pre">indices</span> <span class="pre">to</span> <span class="pre">this</span> <span class="pre">process/task</span> <span class="pre">my_fnames</span> <span class="pre">=</span> <span class="pre">fnames[my_task_id:len(fnames):num_tasks]</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">f</span> <span class="pre">in</span> <span class="pre">my_fnames:</span> <span class="pre">...</span></code></p>
</div></blockquote>
<p>Notice that I am iterating over <code class="docutils literal notranslate"><span class="pre">my_fnames</span></code>, which is a subset of the
full list of filenames determined by the task ID and number of tasks.
This subset will be different for each task in the array. Note that the
third line of code will be different for languages with arrays that
start at index 1 (see the <a class="reference external" href="https://github.com/llsc-supercloud/teaching-examples/tree/master/Julia/word_count/JobArray" target="_blank">Julia Job
Array</a>
code for an example of this).</p>
</div>
<div class="section" id="step-2-changing-your-submission-script">
<h2>Step 2: Changing Your Submission Script<a class="headerlink" href="#step-2-changing-your-submission-script" title="Permalink to this heading"></a></h2>
<p>If you have been running your Job Arrays with sbatch, you most likely
have a few environment variables in your submission script. To submit
with LLsub triples, you can just replace these:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">$SLURM_ARRAY_TASK_ID</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">$LLSUB_RANK</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">$SLURM_ARRAY_TASK_COUNT</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">$LLSUB_SIZE</span></code></li>
</ul>
<p><strong>If you have any SBATCH flags in your submission script, remove those
as well</strong> (LLsub will see these and submit with sbatch, ignoring any
command line arguments you give it). For example, if you are running a
python script, your final submission script will look something like
this:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">#!/bin/bash</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">#</span> <span class="pre">Initialize</span> <span class="pre">and</span> <span class="pre">Load</span> <span class="pre">Modules</span> <span class="pre">source</span> <span class="pre">/etc/profile</span> <span class="pre">module</span> <span class="pre">load</span> <span class="pre">anaconda/2020a</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">echo</span> <span class="pre">&quot;My</span> <span class="pre">task</span> <span class="pre">ID:</span> <span class="pre">&quot;</span> <span class="pre">$LLSUB_RANK</span> <span class="pre">echo</span> <span class="pre">&quot;Number</span> <span class="pre">of</span> <span class="pre">Tasks:</span> <span class="pre">&quot;</span> <span class="pre">$LLSUB_SIZE</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">python</span> <span class="pre">top5each.py</span> <span class="pre">$LLSUB_RANK</span> <span class="pre">$LLSUB_SIZE</span></code></p>
</div></blockquote>
<p>You will also need to make your script executable. You can do that with
this simple command line command:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">u+x</span> <span class="pre">submit_LLsub.sh</span></code></div></blockquote>
</div>
<div class="section" id="step-3-submit-your-job-with-llsub-triples">
<h2>Step 3: Submit your Job with LLsub Triples<a class="headerlink" href="#step-3-submit-your-job-with-llsub-triples" title="Permalink to this heading"></a></h2>
<p>Now when you submit your job, you can run:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">LLsub</span> <span class="pre">./submit.sh</span> <span class="pre">[NODES,NPPN,NT]</span></code></div></blockquote>
<p>where</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">NODES</span></code> is the number of nodes you want to use up</li>
<li><code class="docutils literal notranslate"><span class="pre">NPPN</span></code> is the number of processes that should run per node</li>
<li><code class="docutils literal notranslate"><span class="pre">NT</span></code> is the number of threads per process</li>
</ul>
<p>The total number of threads per node, or <code class="docutils literal notranslate"><span class="pre">NT*NPPN</span></code>, should not be more
than the number of cores on the node, otherwise you may overwhelm the
node with too many running processes and/or threads. For example, if you
are running on the 48-core Xeon-P8 nodes, if you are running with
<code class="docutils literal notranslate"><span class="pre">NT</span></code>=1, you should not set <code class="docutils literal notranslate"><span class="pre">NPPN</span></code> more than 48. If <code class="docutils literal notranslate"><span class="pre">NT</span></code>=2,
<code class="docutils literal notranslate"><span class="pre">NPPN</span></code> should be at most 24, etc. The numbers you choose depend on
your application, if it is multithreaded it may be worth increasing
<code class="docutils literal notranslate"><span class="pre">NT</span></code> and decreasing <code class="docutils literal notranslate"><span class="pre">NPPN</span></code>. If your application consumes a lot of
memory, you may need to decrease <code class="docutils literal notranslate"><span class="pre">NPPN</span></code> so each process has the memory
it needs to proceed. The best way to determine what numbers to choose is
to <a class="reference internal" href="../submitting_jobs/index.html#tuning"><span class="std std-ref">tune your triples</span></a>, which is
a relatively quick exercise and can improve your speedup in the long run
by helping you select the ideal numbers for your triple.</p>
<p>So if you want to run on 2 nodes, 10 processes per node, and 4 threads
per process, you would run:</p>
<blockquote>
<div><code class="docutils literal notranslate"><span class="pre">LLsub</span> <span class="pre">./submit.sh</span> <span class="pre">[2,10,4]</span></code></div></blockquote>
<p>If you were to run LLstat after running this command, you would see what
looks like a 2 task job array, for example:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">LLstat</span> <span class="pre">LLGrid:</span> <span class="pre">txe1</span> <span class="pre">(running</span> <span class="pre">slurm-wlm</span> <span class="pre">20.11.3)</span> <span class="pre">JOBID</span> <span class="pre">ARRAY_JOB_</span> <span class="pre">NAME</span> <span class="pre">USER</span> <span class="pre">START_TIME</span> <span class="pre">PARTITION</span> <span class="pre">CPUS</span> <span class="pre">FEATURES</span> <span class="pre">MIN_MEMORY</span> <span class="pre">ST</span> <span class="pre">NODELIST(REASON)</span> <span class="pre">9651412_1</span> <span class="pre">9651412</span> <span class="pre">submit_LLsub.sh</span> <span class="pre">studentx</span> <span class="pre">2021-03-19T10:32:26</span> <span class="pre">normal</span> <span class="pre">40</span> <span class="pre">xeon-g6</span> <span class="pre">8500M</span> <span class="pre">R</span> <span class="pre">d-13-8-2</span> <span class="pre">9651412_2</span> <span class="pre">9651412</span> <span class="pre">submit_LLsub.sh</span> <span class="pre">studentx</span> <span class="pre">2021-03-19T10:32:26</span> <span class="pre">normal</span> <span class="pre">40</span> <span class="pre">xeon-g6</span> <span class="pre">8500M</span> <span class="pre">R</span> <span class="pre">d-13-8-1</span></code></p>
<p>However, you are still running 2*10 = 20 total processes. Triples mode
uses slurm to request full nodes, then takes care of launching the
processes on each node. This is why you’ll always see one task for each
node in the <code class="docutils literal notranslate"><span class="pre">LLstat</span></code> output, rather than each process. One advantage
of this is it makes for a more compact <code class="docutils literal notranslate"><span class="pre">LLstat</span></code> output that is easier
to read, instead of having to scroll through tons of tasks.</p>
<p>You can check on your individual processes by looking at the log files.
LLsub with Triples mode will create a directory with the prefix “LLSUB”
followed by a unique number to hold all the log files. Within this
directory will be one launch log file, which will capture any errors
that occur during launch ,and one directory per node and put the log
files for each process in its node’s directory. These subdirectories are
labeled with the process ID range and the node name.</p>
<p>For example, here are the log files from a triples run using [2,4,10]:</p>
<p><code class="docutils literal notranslate"><span class="pre">$</span> <span class="pre">ls</span> <span class="pre">LLSUB.23004</span> <span class="pre">README.md</span> <span class="pre">helpers.py</span> <span class="pre">submit_LLsub.sh</span> <span class="pre">submit_sbatch.sh</span> <span class="pre">top5each.py</span> <span class="pre">$</span> <span class="pre">ls</span> <span class="pre">LLSUB.23004/</span> <span class="pre">llsub-triple-mode-launch.log-10006591</span> <span class="pre">p0-p3_d-19-4-1</span> <span class="pre">p4-p7_d-19-3-4</span> <span class="pre">$</span> <span class="pre">ls</span> <span class="pre">LLSUB.23004/p0-p3_d-19-4-1/</span> <span class="pre">submit_LLsub.sh.log.4</span> <span class="pre">submit_LLsub.sh.log.5</span> <span class="pre">submit_LLsub.sh.log.6</span> <span class="pre">submit_LLsub.sh.log.7</span> <span class="pre">$</span> <span class="pre">ls</span> <span class="pre">LLSUB.23004/p4-p7_d-19-3-4/</span> <span class="pre">submit_LLsub.sh.log.4</span> <span class="pre">submit_LLsub.sh.log.5</span> <span class="pre">submit_LLsub.sh.log.6</span> <span class="pre">submit_LLsub.sh.log.7</span></code></p>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">LLSUB.23004</span></code> is the directory containing the log
files, <code class="docutils literal notranslate"><span class="pre">llsub-triple-mode-launch.log-10006591</span></code> is the log file for the
job launch. <code class="docutils literal notranslate"><span class="pre">p0-p3_d-19-4-1</span></code> and <code class="docutils literal notranslate"><span class="pre">p4-p7_d-19-3-4</span></code> are the
directories for each node, and <code class="docutils literal notranslate"><span class="pre">submit_LLsub.sh.log.0</span></code>,
<code class="docutils literal notranslate"><span class="pre">submit_LLsub.sh.log.1</span></code>, …, <code class="docutils literal notranslate"><span class="pre">submit_LLsub.sh.log.7</span></code> are the log
files for each process.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../submitting_jobs/index.html" class="btn btn-neutral float-left" title="Submitting Jobs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../best_practices/index.html" class="btn btn-neutral float-right" title="Best Practices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, MIT SuperCloud Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>