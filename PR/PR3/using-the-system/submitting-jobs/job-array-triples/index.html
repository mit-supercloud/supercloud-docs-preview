
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://supercloud.mit.edu/using-the-system/submitting-jobs/job-array-triples/">
      
      
        <link rel="prev" href="../submitting-jobs/">
      
      
        <link rel="next" href="../../best-practices/filesystem/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.5">
    
    
      
        <title>Job Array Triples - SuperCloud Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7a7fce14.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#job-arrays-with-llsub-triples-in-3-steps" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="SuperCloud Docs" class="md-header__button md-logo" aria-label="SuperCloud Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SuperCloud Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Job Array Triples
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="SuperCloud Docs" class="md-nav__button md-logo" aria-label="SuperCloud Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SuperCloud Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../requesting-account/" class="md-nav__link">
        Requesting an Account
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../systems-and-software/" class="md-nav__link">
        Systems and Software
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../acknowledging-us/" class="md-nav__link">
        Acknowledging Us
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Using the System
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Using the System
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
      
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          Files and Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Files and Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../files-and-data/transferring-files/" class="md-nav__link">
        Transferring Files
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../files-and-data/shared-groups/" class="md-nav__link">
        Shared Groups
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_2" >
      
      
      
        <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
          Installing Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_2">
          <span class="md-nav__icon md-icon"></span>
          Installing Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../software-packages/" class="md-nav__link">
        Software and Package Management
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
          Submitting Jobs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_3">
          <span class="md-nav__icon md-icon"></span>
          Submitting Jobs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../monitoring-system-and-jobs/" class="md-nav__link">
        Monitoring System and Job Status
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../submitting-jobs/" class="md-nav__link">
        Submitting Jobs
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Job Array Triples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Job Array Triples
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-batch-up-your-array" class="md-nav__link">
    Step 1: Batch Up your Array
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-changing-your-submission-script" class="md-nav__link">
    Step 2: Changing Your Submission Script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-submit-your-job-with-llsub-triples" class="md-nav__link">
    Step 3: Submit your Job with LLsub Triples
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          Best Practices
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Best Practices
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/filesystem/" class="md-nav__link">
        Best Practices for using the Filesystem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../best-practices/gpu-jobs/" class="md-nav__link">
        Optimizing your GPU Jobs
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
      
      
      
        <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
          Web Portal
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          Web Portal
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../web-portal/" class="md-nav__link">
        Logging In
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../databases/" class="md-nav__link">
        Databases
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../jupyter-notebooks/" class="md-nav__link">
        Jupyter Notebooks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../faqs/" class="md-nav__link">
        Frequently Asked Questions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../getting-help/" class="md-nav__link">
        Getting Help
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../glossary/" class="md-nav__link">
        Glossary
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#step-1-batch-up-your-array" class="md-nav__link">
    Step 1: Batch Up your Array
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-changing-your-submission-script" class="md-nav__link">
    Step 2: Changing Your Submission Script
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-3-submit-your-job-with-llsub-triples" class="md-nav__link">
    Step 3: Submit your Job with LLsub Triples
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="job-arrays-with-llsub-triples-in-3-steps">Job Arrays with LLsub Triples in 3 Steps</h1>
<p>If you are currently running a Job Array, you can take advantage of
SuperCloud's triples mode submission by submitting your job array with
LLsub. In most cases, this can be done in a few easy steps.</p>
<p>What is triples mode? It's a different way to submit your job by
specifying three numbers:</p>
<ul>
<li>Nodes: The number of nodes you want to use up</li>
<li>NPPN: The number of processes that should run per node</li>
<li>NTPP: The number of threads per process</li>
</ul>
<p>Why would you want to use triples mode to submit your job? Triples mode
provides a few advantages. Since it does whole-node scheduling you
don't have to worry about other jobs impacting yours (or your job
impacting someone else's). We also do task-pinning when you request
resources with a triple, so your processes are arranged in the best way
possible for the layout of the hardware architecture. Finally,
submitting a Job Array with LLsub triples mode the way we describe here
will greatly reduce the startup time for your jobs, over a job array
with many pending tasks.</p>
<h2 id="step-1-batch-up-your-array">Step 1: Batch Up your Array</h2>
<p>The first thing you want to do is set up your job so that your script
splits up your inputs among each process/task and each process/task
iterates a subset of your inputs. This way you can change your input set
without changing the number of tasks or processes that you schedule.
This step alone will save you on startup time. Anytime you submit more
jobs than your allocation allows, those additional jobs will remaining
pending until some of your first running jobs complete. Then, when one
of your first jobs complete, the scheduler now has to find the pending
job some resources and start it running. If you batch up your job array,
you only have to go through the scheduling process once. If you've set
up a job array following our instructions in the past you may already be
doing this, and you can skip to the next section.</p>
<p>First you want to take a look at your code. Code that can be submitted
as a Job Array usually has one big for loop. If you are iterating over
multiple parameters or files, and have nested for loops, you'll first
want to enumerate all the combinations of what you are iterating over so
you have one big loop.</p>
<p>If your code is written so it uses the <code>$SLURM_ARRAY_TASK_ID</code> and uses
that to run a single thing, first add a for loop that iterates over the
full set of things you want to run your code on. If you can't rewrite
your code in such a way that it iterates over multiple inputs, you can
use LLMapReduce to submit your job with triples mode, see <a href="https://github.com/llsc-supercloud/teaching-examples/tree/master/C-Cpp/Fibonacci/LLMapReduce">this
example</a>.</p>
<p>Then you add a few lines to your code to take in two arguments, a
process/task ID and the number of processes/tasks, and use those numbers
to split up the thing you are iterating over. For example, I might have
a list of filenames, <code>fnames</code>. In python I would add:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Python</label><label for="__tabbed_1_2">Julia</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Grab the arguments that are passed in</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">my_task_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">num_tasks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="c1"># Assign indices to this process/task</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">my_fnames</span> <span class="o">=</span> <span class="n">fnames</span><span class="p">[</span><span class="n">my_task_id</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">fnames</span><span class="p">):</span><span class="n">num_tasks</span><span class="p">]</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">my_fnames</span><span class="p">:</span> <span class="o">...</span>
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-julia highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c"># Grab the arguments that are passed in</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">task_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span><span class="nb">ARGS</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">num_tasks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse</span><span class="p">(</span><span class="kt">Int</span><span class="p">,</span><span class="nb">ARGS</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="c"># Assign indices to this process/task</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="n">my_fnames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fnames</span><span class="p">[</span><span class="n">task_id</span><span class="o">+</span><span class="mi">1</span><span class="o">:</span><span class="n">num_tasks</span><span class="o">:</span><span class="n">length</span><span class="p">(</span><span class="n">fnames</span><span class="p">)]</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="k">for</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">my_fnames</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="o">...</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Notice that I am iterating over <code>my_fnames</code>, which is a subset of the
full list of filenames determined by the task ID and number of tasks.
This subset will be different for each task in the array. Note that the
third line of code will be different for languages with arrays that
start at index 1 (see the <a href="https://github.com/llsc-supercloud/teaching-examples/tree/master/Julia/word_count/JobArray">Julia Job
Array</a>
code for an example of this).</p>
<h2 id="step-2-changing-your-submission-script">Step 2: Changing Your Submission Script</h2>
<p>If you have been running your Job Arrays with sbatch, you most likely
have a few environment variables in your submission script. To submit
with LLsub triples, you can just replace these:</p>
<ul>
<li><code>$SLURM_ARRAY_TASK_ID</code> -> <code>$LLSUB_RANK</code></li>
<li><code>$SLURM_ARRAY_TASK_COUNT</code> -> <code>$LLSUB_SIZE</code></li>
</ul>
<p><strong>If you have any SBATCH flags in your submission script, remove those
as well</strong> (LLsub will see these and submit with sbatch, ignoring any
command line arguments you give it). For example, if you are running a
python script, your final submission script will look something like
this:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="ch">#!/bin/bash</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="c1"># Load Module(s)</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>module<span class="w"> </span>load<span class="w"> </span>anaconda/2023a
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;My task ID: &quot;</span><span class="w"> </span><span class="nv">$LLSUB_RANK</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Number of Tasks: &quot;</span><span class="w"> </span><span class="nv">$LLSUB_SIZE</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>python<span class="w"> </span>top5each.py<span class="w"> </span><span class="nv">$LLSUB_RANK</span><span class="w"> </span><span class="nv">$LLSUB_SIZE</span>
</span></code></pre></div>
<p>You will also need to make your script executable. You can do that with
this simple command line command:</p>
<blockquote>
<p><code>chmod u+x submit_LLsub.sh</code></p>
</blockquote>
<h2 id="step-3-submit-your-job-with-llsub-triples">Step 3: Submit your Job with LLsub Triples</h2>
<p>Now when you submit your job, you can run:</p>
<blockquote>
<p><code>LLsub ./submit.sh [NODES,NPPN,NTPP]</code></p>
</blockquote>
<p>where</p>
<ul>
<li><code>NODES</code> is the number of nodes you want to use up</li>
<li><code>NPPN</code> is the number of processes that should run per node</li>
<li><code>NTPP</code> is the number of threads per process</li>
</ul>
<p>The total number of threads per node, or <code>NTPP*NPPN</code>, should not be more
than the number of cores on the node, otherwise you may overwhelm the
node with too many running processes and/or threads. For example, if you
are running on the 48-core Xeon-P8 nodes, if you are running with
<code>NTPP</code>=1, you should not set <code>NPPN</code> more than 48. If <code>NTPP</code>=2, <code>NPPN</code> should
be at most 24, etc. The numbers you choose depend on your application,
if it is multithreaded it may be worth increasing <code>NTPP</code> and decreasing
<code>NPPN</code>. If your application consumes a lot of memory, you may need to
decrease <code>NPPN</code> so each process has the memory it needs to proceed. The
best way to determine what numbers to choose is to
<a href="../submitting-jobs/#triples-mode-tuning">tune your triples</a>, which is a
relatively quick exercise and can improve your speedup in the long run
by helping you select the ideal numbers for your triple.</p>
<p>So if you want to run on 2 nodes, 10 processes per node, and 4 threads
per process, you would run:</p>
<blockquote>
<p><code>LLsub ./submit.sh [2,10,4]</code></p>
</blockquote>
<p>If you were to run LLstat after running this command, you would see what
looks like a 2 task job array, for example:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>$<span class="w"> </span>LLstat
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>LLGrid:<span class="w"> </span>txe1<span class="w"> </span><span class="o">(</span>running<span class="w"> </span>slurm-wlm<span class="w"> </span><span class="m">20</span>.11.3<span class="o">)</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>JOBID<span class="w"> </span>ARRAY_JOB_<span class="w"> </span>NAME<span class="w"> </span>USER<span class="w"> </span>START_TIME<span class="w"> </span>PARTITION<span class="w"> </span>CPUS<span class="w"> </span>FEATURES<span class="w"> </span>MIN_MEMORY<span class="w"> </span>ST<span class="w"> </span>NODELIST<span class="o">(</span>REASON<span class="o">)</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>9651412_1<span class="w"> </span><span class="m">9651412</span><span class="w"> </span>submit_LLsub.sh<span class="w"> </span>studentx<span class="w"> </span><span class="m">2021</span>-03-19T10:32:26<span class="w"> </span>normal<span class="w"> </span><span class="m">40</span><span class="w"> </span>xeon-g6<span class="w"> </span>8500M<span class="w"> </span>R<span class="w"> </span>d-13-8-2
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>9651412_2<span class="w"> </span><span class="m">9651412</span><span class="w"> </span>submit_LLsub.sh<span class="w"> </span>studentx<span class="w"> </span><span class="m">2021</span>-03-19T10:32:26<span class="w"> </span>normal<span class="w"> </span><span class="m">40</span><span class="w"> </span>xeon-g6<span class="w"> </span>8500M<span class="w"> </span>R<span class="w"> </span>d-13-8-1
</span></code></pre></div>
<p>However, you are still running 2*10 = 20 total processes. Triples mode
uses slurm to request full nodes, then takes care of launching the
processes on each node. This is why you'll always see one task for each
node in the <code>LLstat</code> output, rather than each process. One advantage of
this is it makes for a more compact <code>LLstat</code> output that is easier to
read, instead of having to scroll through tons of tasks.</p>
<p>You can check on your individual processes by looking at the log files.
LLsub with Triples mode will create a directory with the prefix
"LLSUB" followed by a unique number to hold all the log files. Within
this directory will be one launch log file, which will capture any
errors that occur during launch ,and one directory per node and put the
log files for each process in its node's directory. These
subdirectories are labeled with the process ID range and the node name.</p>
<p>For example, here are the log files from a triples run using [2,4,10]:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>$<span class="w"> </span>ls<span class="w"> </span>LLSUB.23004
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>README.md<span class="w"> </span>helpers.py<span class="w"> </span>submit_LLsub.sh<span class="w"> </span>submit_sbatch.sh<span class="w"> </span>top5each.py
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>$<span class="w"> </span>ls<span class="w"> </span>LLSUB.23004/
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>llsub-triple-mode-launch.log-10006591<span class="w"> </span>p0-p3_d-19-4-1<span class="w"> </span>p4-p7_d-19-3-4
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>$<span class="w"> </span>ls<span class="w"> </span>LLSUB.23004/p0-p3_d-19-4-1/
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>submit_LLsub.sh.log.4<span class="w"> </span>submit_LLsub.sh.log.5<span class="w"> </span>submit_LLsub.sh.log.6<span class="w"> </span>submit_LLsub.sh.log.7
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>$<span class="w"> </span>ls<span class="w"> </span>LLSUB.23004/p4-p7_d-19-3-4/
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>submit_LLsub.sh.log.4<span class="w"> </span>submit_LLsub.sh.log.5<span class="w"> </span>submit_LLsub.sh.log.6<span class="w"> </span>submit_LLsub.sh.log.7
</span></code></pre></div>
<p>In this example, <code>LLSUB.23004</code> is the directory containing the log
files, <code>llsub-triple-mode-launch.log-10006591</code> is the log file for the
job launch. <code>p0-p3_d-19-4-1</code> and <code>p4-p7_d-19-3-4</code> are the directories
for each node, and <code>submit_LLsub.sh.log.0</code>, <code>submit_LLsub.sh.log.1</code>,
..., <code>submit_LLsub.sh.log.7</code> are the log files for each process.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.407015b8.min.js"></script>
      
    
  </body>
</html>